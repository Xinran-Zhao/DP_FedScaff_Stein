(scaffold) xzhao181@en4228312l:~/DP_FedScaff_Stein$ python ./src/server/fedavg.py --dataset mnist --dp_sigma=0.05 --clip_bound=100 --global_epochs=100 --local_epochs=20 --jse=True
/home/local/ASURITE/xzhao181/DP_FedScaff_Stein/src/server/base.py:68: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.global_params_dict = torch.load(self.temp_dir / "global_model.pt")
Find existed global model...                                                                                                                                                                                                 
Have run 0 epochs already.                                                                                                                                                                                                   
Backbone: LeNet5(                                                                                                                                                                                                            
  (net): Sequential(                                                                                                                                                                                                         
    (0): Conv2d(1, 6, kernel_size=(5, 5), stride=(1, 1))                                                                                                                                                                     
    (1): ReLU(inplace=True)                                                                                                                                                                                                  
    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)                                                                                                                                          
    (3): Conv2d(6, 16, kernel_size=(5, 5), stride=(1, 1))                                                                                                                                                                    
    (4): ReLU(inplace=True)                                                                                                                                                                                                  
    (5): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)                                                                                                                                          
    (6): Flatten(start_dim=1, end_dim=-1)                                                                                                                                                                                    
    (7): Linear(in_features=256, out_features=120, bias=True)                                                                                                                                                                
    (8): ReLU(inplace=True)                                                                                                                                                                                                  
    (9): Linear(in_features=120, out_features=84, bias=True)                                                                                                                                                                 
    (10): ReLU(inplace=True)                                                                                                                                                                                                 
    (11): Linear(in_features=84, out_features=10, bias=True)                                                                                                                                                                 
  )                                                                                                                                                                                                                          
)                                                                                                                                                                                                                            
Arguments:                                                                                                                                                                                                                   
{                                                                                                                                                                                                                            
    'global_epochs': 100,                                                                                                                                                                                                    
    'local_epochs': 20,                                                                                                                                                                                                      
    'local_lr': 0.01,                                                                                                                                                                                                        
    'verbose_gap': 5,                                                                                                                                                                                                        
    'dataset': 'mnist',                                                                                                                                                                                                      
    'batch_size': -1,                                                                                                                                                                                                        
    'gpu': 1,                                                                                                                                                                                                                
    'log': 0,                                                                                                                                                                                                                
    'seed': 17,                                                                                                                                                                                                              
    'client_num_per_round': 5,                                                                                                                                                                                               
    'save_period': 5,                                                                                                                                                                                                        
    'dp_sigma': 0.05,                                                                                                                                                                                                        
    'clip_bound': 100.0,                                                                                                                                                                                                     
    'jse': True                                                                                                                                                                                                              
}                                                                                                                                                                                                                            
============================== TRAINING ==============================                                                                                                                                                       
============================== ROUND: 0 ==============================                                                                                                                                                       
client [3]   loss: 1.9718 -> 0.1392    accuracy: 18.06% -> 95.45%                                                                                                                                                            
client [4]   loss: 3.4792 -> 0.4446    accuracy: 0.82% -> 84.78%                                                                                                                                                             
client [0]   loss: 3.7440 -> 0.2873    accuracy: 0.26% -> 92.07%                                                                                                                                                             
client [1]   loss: 3.0931 -> 0.3274    accuracy: 24.56% -> 89.60%                                                                                                                                                            
client [2]   loss: 2.4337 -> 0.2182    accuracy: 6.67% -> 93.59%                                                                                                                                                             
============================== ROUND: 5 ==============================                                                                                                                                                       
client [4]   loss: 3.4908 -> 0.3761    accuracy: 1.29% -> 87.66%                                                                                                                                                             
client [0]   loss: 3.7438 -> 0.3130    accuracy: 0.77% -> 91.82%                                                                                                                                                             
client [1]   loss: 3.1063 -> 0.3540    accuracy: 24.23% -> 89.01%                                                                                                                                                            
client [2]   loss: 2.4301 -> 0.2089    accuracy: 8.19% -> 93.66%                                                                                                                                                             
client [3]   loss: 1.9792 -> 0.1380    accuracy: 18.55% -> 95.52%                                                                                                                                                            
============================== ROUND: 10 ==============================                                                                                                                                                      
client [4]   loss: 3.4951 -> 0.7808    accuracy: 1.90% -> 76.61%                                                                                                                                                             
client [1]   loss: 3.1160 -> 0.3044    accuracy: 24.49% -> 90.85%                                                                                                                                                            
client [0]   loss: 3.7315 -> 0.2584    accuracy: 1.28% -> 92.58%                                                                                                                                                             
client [2]   loss: 2.4320 -> 0.2167    accuracy: 9.38% -> 93.06%                                                                                                                                                             
client [3]   loss: 1.9851 -> 0.1321    accuracy: 18.67% -> 95.33%                                                                                                                                                            
============================== ROUND: 15 ==============================                                                                                                                                                      
client [1]   loss: 3.1095 -> 0.2913    accuracy: 24.49% -> 90.52%                                                                                                                                                            
client [4]   loss: 3.5009 -> 1.6433    accuracy: 2.16% -> 63.91%                                                                                                                                                             
client [0]   loss: 3.7160 -> 0.2893    accuracy: 1.28% -> 92.84%                                                                                                                                                             
client [2]   loss: 2.4293 -> 0.2107    accuracy: 10.57% -> 94.06%                                                                                                                                                            
client [3]   loss: 1.9875 -> 0.1341    accuracy: 19.41% -> 95.27%                                                                                                                                                            
============================== ROUND: 20 ==============================                                                                                                                                                      
client [2]   loss: 2.4281 -> 0.2149    accuracy: 11.16% -> 93.92%                                                                                                                                                            
client [0]   loss: 3.6937 -> 0.2728    accuracy: 1.53% -> 92.07%                                                                                                                                                             
client [1]   loss: 3.0951 -> 0.2989    accuracy: 24.69% -> 91.11%                                                                                                                                                            
client [4]   loss: 3.4858 -> 0.2691    accuracy: 2.62% -> 91.88%                                                                                                                                                             
client [3]   loss: 1.9953 -> 0.1409    accuracy: 19.41% -> 94.96%                                                                                                                                                            
============================== ROUND: 25 ==============================                                                                                              
client [4]   loss: 3.4802 -> 0.9433    accuracy: 2.83% -> 69.77%                                                                                                     
client [0]   loss: 3.6694 -> 0.2711    accuracy: 1.79% -> 92.84%                                                                                                     
client [1]   loss: 3.0781 -> 0.3044    accuracy: 24.75% -> 89.34%                                                                                                    
client [3]   loss: 1.9922 -> 0.1353    accuracy: 20.09% -> 95.15%                                                                                                    
client [2]   loss: 2.4336 -> 0.2198    accuracy: 11.96% -> 93.59%                                                                                                    
============================== ROUND: 30 ==============================                                                                                              
client [3]   loss: 1.9910 -> 0.1676    accuracy: 20.64% -> 94.16%                                                                                                    
client [1]   loss: 3.0657 -> 0.3226    accuracy: 24.82% -> 89.40%                                                                                                    
client [0]   loss: 3.6400 -> 0.2587    accuracy: 2.30% -> 93.61%                                                                                                     
client [4]   loss: 3.4610 -> 0.6525    accuracy: 3.03% -> 80.51%                                                                                                     
client [2]   loss: 2.4191 -> 0.2054    accuracy: 13.67% -> 93.73%                                                                                                    
============================== ROUND: 35 ==============================                                                                                              
client [0]   loss: 3.6076 -> 0.2537    accuracy: 2.56% -> 93.35%                                                                                                     
client [3]   loss: 1.9881 -> 0.1267    accuracy: 21.62% -> 95.52%                                                                                                    
client [2]   loss: 2.4103 -> 0.2033    accuracy: 14.80% -> 93.92%                                                                                                    
client [1]   loss: 3.0473 -> 0.2843    accuracy: 24.82% -> 90.98%                                                                                                    
client [4]   loss: 3.4573 -> 0.3010    accuracy: 3.24% -> 90.54%                                                                                                     
============================== ROUND: 40 ==============================                                                                                              
client [2]   loss: 2.4070 -> 0.2044    accuracy: 15.39% -> 93.39%                                                                                                    
client [3]   loss: 2.0020 -> 0.1246    accuracy: 22.05% -> 95.64%                                                                                                    
client [4]   loss: 3.4489 -> 0.2583    accuracy: 3.65% -> 91.72%                                                                                                     
client [1]   loss: 3.0217 -> 0.2861    accuracy: 25.15% -> 90.72%                                                                                                    
client [0]   loss: 3.5547 -> 0.2612    accuracy: 2.56% -> 92.07%                                                                                                     
============================== ROUND: 45 ==============================                                                                                              
client [1]   loss: 3.0084 -> 0.2791    accuracy: 25.15% -> 91.24%                                                                                                    
client [3]   loss: 1.9927 -> 0.1250    accuracy: 22.85% -> 95.27%                                                                                                    
client [2]   loss: 2.4203 -> 0.2039    accuracy: 15.79% -> 93.92%                                                                                                    
client [4]   loss: 3.4506 -> 0.2341    accuracy: 3.80% -> 92.85%                                                                                                     
client [0]   loss: 3.5201 -> 0.2568    accuracy: 2.56% -> 93.09%                                                                                                     
============================== ROUND: 50 ==============================                                                                                              
client [1]   loss: 2.9722 -> 0.2669    accuracy: 25.41% -> 91.31%                                                                                                    
client [0]   loss: 3.4633 -> 0.2708    accuracy: 4.35% -> 91.30%                                                                                                     
client [2]   loss: 2.4220 -> 0.2098    accuracy: 15.92% -> 93.79%                                                                                                    
client [3]   loss: 2.0002 -> 0.1255    accuracy: 23.59% -> 96.07%                                                                                                    
client [4]   loss: 3.4174 -> 0.2125    accuracy: 4.37% -> 93.62%                                                                                                     
============================== ROUND: 55 ==============================                                                                                              
client [1]   loss: 2.9521 -> 0.2665    accuracy: 25.35% -> 91.44%                                                                                                    
client [2]   loss: 2.4230 -> 0.1970    accuracy: 15.92% -> 93.59%                                                                                                    
client [3]   loss: 1.9930 -> 0.1263    accuracy: 24.57% -> 95.58%                                                                                                    
client [4]   loss: 3.4131 -> 0.2268    accuracy: 4.63% -> 92.60%                                                                                                     
client [0]   loss: 3.4040 -> 0.2537    accuracy: 4.09% -> 92.07%                                                                                                     
============================== ROUND: 60 ==============================                                                                                              
client [2]   loss: 2.4222 -> 0.2026    accuracy: 16.18% -> 94.06%                                                                                                    
client [0]   loss: 3.3529 -> 0.2235    accuracy: 4.09% -> 94.63%                                                                                                     
client [3]   loss: 1.9871 -> 0.1253    accuracy: 25.18% -> 95.76%                                                                                                    
client [1]   loss: 2.9069 -> 0.2826    accuracy: 25.87% -> 90.85%                                                                                                    
client [4]   loss: 3.3871 -> 0.2122    accuracy: 4.88% -> 93.57%                                                                                                     
============================== ROUND: 65 ==============================                                                                                              
client [0]   loss: 3.2657 -> 0.2301    accuracy: 4.86% -> 92.84%                                                                                                     
client [3]   loss: 1.9770 -> 0.1254    accuracy: 25.98% -> 95.58%                                                                                                    
client [1]   loss: 2.8550 -> 0.2566    accuracy: 25.87% -> 92.10%                                                                                                    
client [2]   loss: 2.4059 -> 0.2022    accuracy: 17.57% -> 94.32%                                                                                                    
client [4]   loss: 3.3592 -> 0.2177    accuracy: 5.24% -> 93.32%                                                                                                     
============================== ROUND: 70 ==============================                                                                                              
client [3]   loss: 1.9735 -> 0.1209    accuracy: 26.29% -> 95.70%                                                                                                    
client [0]   loss: 3.1958 -> 0.2194    accuracy: 5.37% -> 94.63%                                                                                                     
client [4]   loss: 3.3308 -> 0.2168    accuracy: 5.60% -> 92.96%                                                                                                     
client [1]   loss: 2.8074 -> 0.2587    accuracy: 26.40% -> 91.71%                                                                                                    
client [2]   loss: 2.3950 -> 0.2081    accuracy: 18.56% -> 93.06%                                                                                                    
============================== ROUND: 75 ==============================                                                                                              
client [3]   loss: 1.9615 -> 0.1264    accuracy: 27.40% -> 95.33%                                                                                                    
client [4]   loss: 3.2994 -> 0.1976    accuracy: 6.38% -> 93.98%                                                                                                     
client [1]   loss: 2.7661 -> 0.2902    accuracy: 26.27% -> 90.72%                                                                                                    
client [0]   loss: 3.1207 -> 0.2191    accuracy: 6.14% -> 93.61%                                                                                                     
client [2]   loss: 2.3972 -> 0.2167    accuracy: 19.75% -> 93.59%                                                                                                    
============================== ROUND: 80 ==============================                                                                                              
client [3]   loss: 1.9592 -> 0.1204    accuracy: 28.01% -> 95.70%                                                                                                    
client [1]   loss: 2.7392 -> 0.2553    accuracy: 26.27% -> 92.30%                                                                                                    
client [2]   loss: 2.4032 -> 0.2035    accuracy: 20.67% -> 93.59%                                                                                                    
client [0]   loss: 3.0413 -> 0.2244    accuracy: 7.42% -> 93.61%                                                                                                     
client [4]   loss: 3.2666 -> 0.2398    accuracy: 6.99% -> 93.62%                                                                                                     
============================== ROUND: 85 ==============================                                                                                              
client [3]   loss: 1.9609 -> 0.1191    accuracy: 28.44% -> 96.01%                                                                                                    
client [2]   loss: 2.3969 -> 0.2101    accuracy: 21.66% -> 93.59%                                                                                                    
client [0]   loss: 2.9753 -> 0.2135    accuracy: 8.70% -> 93.35%                                                                                                     
client [4]   loss: 3.2310 -> 0.1833    accuracy: 7.25% -> 94.09%                                                                                                     
client [1]   loss: 2.7074 -> 0.2681    accuracy: 26.66% -> 90.92%                                                                                                    
============================== ROUND: 90 ==============================                                                                                              
client [4]   loss: 3.2002 -> 0.2018    accuracy: 8.28% -> 93.42%                                                                                                     
client [2]   loss: 2.3708 -> 0.1908    accuracy: 22.26% -> 94.52%                                                                                                    
client [1]   loss: 2.6535 -> 0.2414    accuracy: 27.12% -> 92.17%                                                                                                    
client [0]   loss: 2.8729 -> 0.1993    accuracy: 9.72% -> 94.12%                                                                                                     
client [3]   loss: 1.9617 -> 0.1208    accuracy: 28.81% -> 95.70%                                                                                                    
============================== ROUND: 95 ==============================                                                                                              
client [2]   loss: 2.3657 -> 0.1958    accuracy: 23.18% -> 93.92%                                                                                                    
client [3]   loss: 1.9591 -> 0.1241    accuracy: 29.42% -> 95.52%                                                                                                    
client [0]   loss: 2.7712 -> 0.1982    accuracy: 11.00% -> 94.12%                                                                                                    
client [1]   loss: 2.6085 -> 0.3153    accuracy: 27.85% -> 89.07%                                                                                                    
client [4]   loss: 3.1531 -> 0.1931    accuracy: 8.59% -> 93.42%                                                                                                     
Training... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:02:49
============================== TESTING ==============================                                                                                                
Testing... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:01
==================== RESULTS ====================                                                                                                                    
loss: 2.5387    accuracy: 21.67%                                                                                                                                     
FedAvg achieved 10.0% accuracy(11.22%) at epoch: 0                                                                                                                   
FedAvg achieved 20.0% accuracy(20.02%) at epoch: 89 